# Docker Compose for BTC Trading Bot & Gabagool Spread Capture
# Polymarket BTC Up/Down 15min Markets

version: '3.8'

services:
  # Real-time Data Collector (runs 24/7)
  collector:
    build: .
    container_name: btc-collector
    restart: unless-stopped
    command: >
      python -m src.realtime_collector
      --output /app/data/raw
      --save-interval 300
    volumes:
      - ./data:/app/data
    environment:
      - TZ=UTC
      - PYTHONUNBUFFERED=1
    healthcheck:
      test: ["CMD", "python", "-c", "import httpx; print('ok')"]
      interval: 60s
      timeout: 10s
      retries: 3
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # Backtest Runner (on-demand)
  backtest:
    build: .
    container_name: btc-backtest
    profiles:
      - backtest
    command: >
      python main.py btc-backtest
      --log-dir /app/data/raw
      --capital 100
      --output /app/data/results
    volumes:
      - ./data:/app/data
    environment:
      - TZ=UTC

  # Quick Test (on-demand)
  test:
    build: .
    container_name: btc-test
    profiles:
      - test
    command: >
      python main.py btc-test
      --markets 50
      --capital 100
    environment:
      - TZ=UTC

  # Analysis (on-demand)
  analyze:
    build: .
    container_name: btc-analyze
    profiles:
      - analyze
    command: >
      python main.py btc-analyze
      --log-dir /app/data/raw
    volumes:
      - ./data:/app/data
    environment:
      - TZ=UTC

  # === GABAGOOL SPREAD CAPTURE SERVICES ===

  # Gabagool Bot - Paper Trading (runs 24/7)
  gabagool-paper:
    build: .
    container_name: gabagool-paper
    restart: unless-stopped
    profiles:
      - gabagool-paper
    command: >
      python main.py gabagool-bot
      --min-spread 0.02
      --order-size 15
      --max-per-market 500
      --assets BTC ETH
    volumes:
      - ./data:/app/data
    environment:
      - TZ=UTC
      - PYTHONUNBUFFERED=1
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # Gabagool Bot - Live Trading (runs 24/7)
  gabagool-live:
    build: .
    container_name: gabagool-live
    restart: unless-stopped
    profiles:
      - gabagool-live
    command: >
      python main.py gabagool-bot
      --live
      --preset moderate
    volumes:
      - ./data:/app/data
    environment:
      - TZ=UTC
      - PYTHONUNBUFFERED=1
      - POLYMARKET_PRIVATE_KEY=${POLYMARKET_PRIVATE_KEY}
      - POLYMARKET_API_KEY=${POLYMARKET_API_KEY}
      - POLYMARKET_API_SECRET=${POLYMARKET_API_SECRET}
      - POLYMARKET_API_PASSPHRASE=${POLYMARKET_API_PASSPHRASE}
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"

  # Gabagool Backtest (on-demand)
  gabagool-backtest:
    build: .
    container_name: gabagool-backtest
    profiles:
      - gabagool-backtest
    command: >
      python main.py gabagool-backtest
      --markets 200
      --min-spread 0.02
      --order-size 15
    volumes:
      - ./data:/app/data
    environment:
      - TZ=UTC

  # Gabagool Quick Test (on-demand)
  gabagool-test:
    build: .
    container_name: gabagool-test
    profiles:
      - gabagool-test
    command: >
      python main.py gabagool-test
      --markets 50
    environment:
      - TZ=UTC

volumes:
  data:
    driver: local
